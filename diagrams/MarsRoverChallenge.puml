@startuml "Mars Rover Challenge"
skinparam classAttributeIconSize 0

class CommandHandler
{
  - instructionReader : IInstructionReader
  - positionStringConverter : IPositionStringConverter
  - plateau : PlateauBase
  - vehicle : VehicleBase
  - RecentPath : List<Position>

  + CommandHandler(instructionReader : IInstructionReader, positionStringConverter : IPositionStringConverter)
  
  + ConnectPlateau(plateau : PlateauBase) : void

  + GetVehicle() : VehicleBase?
  + AddVehicleToPlateau(vehicle : VehicleBase) : (bool, string)
  + ConnectToVehicleAtPosition(position : Position) : (bool, string)
  + SendMoveInstruction(instruction : string) : (bool, string)

  + GetPositionString() : string
  + GetRecentPath() : List<Position>
  + ResetRecentPath() : void
}

interface IInstructionReader <<interface>>
{
  + IsValidInstruction(instruction : string) : bool
  + EvaluateInstruction(instruction : string) : List<SingularInstruction>
}

enum SingularInstruction
{
  TurnLeft
  TurnRight
  MoveForward
}

class StandardInstructionReader
{
  + IsValidInstruction(instruction : string) : bool
  + EvaluateInstruction(instruction : string) : List<SingularInstruction>
}

abstract PlateauBase <<abstract>>
{
  - obstacleCoordinates : List<Coordinates>
  - vehicles : List<VehicleBase>

  + GetObstacleCoordinates() : List<Coordinates>
  + AddObstacle(obstacleCoordinate: Coordinates) : void
  + RemoveObstacle(obstaclecoordinate : Coordinates) : void

  + GetVehicles() : List<VehicleBase>
  + GetVehicleAtPosition(position : Position) : VehicleBase?
  + AddVehicle(vehicle : VehicleBase) : void
  + RemoveVehicle(vehicle : VehicleBase) : void

   + IsCoordinateValidInPlateau(coordinates : Coordinates) : bool
  {abstract} + PrintMap(recentPath : List<Position>) : void
  {abstract} # IsCoordinateWithinPlateauBoundary(coordinates : Coordinates) : bool
}

class RectangularPlateau
{
  - plateauSize : Coordinates

  + RectangularPlateau(plateauSize : Coordinates)

  + PrintMap(recentPath : List<Position>) : void
  # IsCoordinateWithinPlateauBoundary(coordinates : Coordinates) : bool
}

class Coordinates <<struct>>
{
  - x : int
  - y : int

  + GetX() : int
  + GetY() : int

  + operator+(a : Coordinates, b : Coordinates) : Coordinates
}

enum Direction
{
  North
  East
  South
  West

  + GetMovementVector() : Coordinates
  + GetLeftTurn() : Direction
  + GetRightTurn() : Direction
}

interface IPositionStringConverter <<interface>>
{
  + IsValidPositionString(positionString : string) : bool
  + IsValidCoordinateString(coordinateString : string) : bool

  + GetExamplePositionString() : string
  + GetExampleCoordinateString() : string

  + ToPosition(positionString : string) : Position
  + ToCoordinates(coordinateString : string) : Coordinates

  + ToPositionString(position : Position) : string
}

class Position <<struct>>
{
  - coordinates : Coordinates
  - direction : Direction

  + GetCoordinates() : Coordinates
  + GetDirection() : Direction
}

class PositionStringConverter
{
  + IsValidPositionString(positionString : string) : bool
  + IsValidCoordinateString(coordinateString : string) : bool

  + GetExamplePositionString() : string
  + GetExampleCoordinateString() : string

  + ToPosition(positionString : string) : Position
  + ToCoordinates(coordinateString : string) : Coordinates

  + ToPositionString(position : Position) : string
}

class Rover
{
  + Rover(initialPosition : Position)

  + TakePhotoAndSendToStation() : void
  + CollectSample() : void
}

abstract VehicleBase <<abstract>>
{
  - position : Position

  + VehicleBase(initialPosition : Position)

  + GetPosition() : Position
  + ApplyMoveInstruction(instruction : List<SingularInstruction>, \n\
                                     plateau : PlateauBase) : List<Position>
}

CommandHandler o-- IInstructionReader
CommandHandler o-- IPositionStringConverter
CommandHandler o-- PlateauBase
CommandHandler o-- VehicleBase
CommandHandler o---- Position

IInstructionReader --> SingularInstruction
IInstructionReader <|.. StandardInstructionReader 

VehicleBase <|-- Rover
VehicleBase --> SingularInstruction
VehicleBase o--- Position

IPositionStringConverter <|..... PositionStringConverter
IPositionStringConverter ---> Position
IPositionStringConverter ---> Coordinates

PlateauBase <|----- RectangularPlateau
PlateauBase --> Position
PlateauBase o-- Coordinates
PlateauBase o- VehicleBase

Direction --> Coordinates 

Position o-- Direction
Position o-- Coordinates

@enduml